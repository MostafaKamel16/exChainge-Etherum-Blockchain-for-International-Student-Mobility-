{"ast":null,"code":"var _jsxFileName = \"/Users/bob/codes/mobility-blockchain-frontend/src/views/BatchSend.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from \"react\";\nimport { withRouter } from \"react-router-dom\";\nimport { connect } from \"react-redux\";\nimport { Container } from \"react-bootstrap\";\nimport AppNavBar from \"../component/AppNavBar\";\nimport { makeStyles } from '@material-ui/core/styles';\nimport Button from '@material-ui/core/Button';\nimport { Typography, Grid, Container as MUIContainer } from '@mui/material';\nimport { getPartnerStats } from \"../services/api\";\nimport { isAuthenticated } from \"../auth/auth\";\nimport { PieChart } from 'react-minimal-pie-chart';\nimport { setTranscriptsToNotBatched, readBatchedInternalTranscripts } from \"../services/api\";\nimport hash from \"object-hash\";\nimport { sendTranscript } from \"../services/blockchain/contractCalls\";\nimport { startService } from \"../services/blockchain/util\";\nimport SelectionList from \"../component/SelectionList\";\nimport { hashTranscriptBatch, hashTranscripts } from \"../utils/accountUtils\";\nimport Spinner from \"../component/Spinner\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst useStyles = makeStyles(theme => ({\n  container: {\n    //height: '89vh',\n    display: 'flex',\n    justifyContent: 'start' //backgroundColor: theme.palette.primary.light,\n\n  },\n  textField: {\n    width: '100%'\n  },\n  questionContainer: {\n    width: '70%'\n  },\n  questionSectionContainer: {\n    display: 'flex',\n    flexDirection: 'column',\n    alignItems: 'center'\n  },\n  addQuestionIconContainer: {\n    display: 'flex',\n    height: '12rem'\n  },\n  circleIcon: {\n    display: 'box'\n  },\n  leftPane: {\n    width: '60%',\n    paddingTop: '4rem',\n    backgroundColor: 'white',\n    display: 'flex',\n    flexDirection: 'column',\n    alignItems: 'center',\n    border: '1px grey solid'\n  },\n  leftPaneSection: {\n    display: 'flex',\n    flexDirection: 'column',\n    alignItems: 'center'\n  },\n  rightPane: {\n    width: '100%',\n    display: 'flex',\n    overflowY: 'scroll',\n    flexDirection: 'column'\n  },\n  rightPaneTop: {\n    height: '14.5rem',\n    display: 'flex',\n    flexDirection: 'column',\n    backgroundColor: 'white',\n    border: '1px grey solid',\n    padding: '2rem'\n  },\n  modal: {\n    display: 'flex',\n    flexDirection: 'column',\n    alignItems: 'center',\n    justifyContent: 'center',\n    marginTop: '15rem',\n    marginLeft: '30rem',\n    marginRight: '30rem',\n    minHeight: \"220px\",\n    width: \"40%\"\n  },\n  MenuItem: {\n    marginTop: \"30px\"\n  },\n  button: {\n    margin: \"2rem\",\n    justifyContent: 'center'\n  },\n  sectionListContainer: {\n    marginTop: '1rem',\n    height: '20rem',\n    width: '100%',\n    overflowY: 'scroll'\n  },\n  surveyListContainer: {\n    marginTop: '1rem',\n    height: '27.5rem',\n    width: '22rem',\n    overflowY: 'scroll'\n  },\n  surveyListItem: {\n    display: 'flex',\n    height: '4rem',\n    width: '100%',\n    alignItems: 'center',\n    justifyContent: 'space-between',\n    '&:hover': {\n      backgroundColor: theme.palette.primary.light,\n      cursor: 'pointer'\n    }\n  },\n  sectionListItem: {\n    'display': 'flex',\n    'justifyContent': 'center',\n    'height': '4rem',\n    'width': '70%',\n    'marginBottom': '0.5rem',\n    'marginTop': '0.5rem',\n    'alignItems': 'center',\n    '&:hover': {\n      'backgroundColor': theme.palette.primary.light,\n      'cursor': 'pointer'\n    }\n  },\n  upload: {\n    display: 'flex',\n    marginTop: '0.5rem',\n    height: '9rem',\n    width: '75%'\n  },\n  createSurveyButton: {\n    display: 'flex',\n    height: '3rem',\n    width: '15rem'\n  },\n  centerDiv: {\n    display: 'flex',\n    justifyContent: 'center',\n    marginTop: '1rem'\n  },\n  form: {\n    margin: '1rem',\n    width: '40%'\n  },\n  inline: {\n    display: 'flex',\n    justifyContent: 'space-between'\n  },\n  chart: {\n    height: '250px'\n  }\n}));\n\nconst postToServer = async (address, data) => {\n  const response = await fetch(address, {\n    'method': \"POST\",\n    'headers': {\n      'Accept': 'application/json',\n      'Content-Type': 'application/json'\n    },\n    'body': JSON.stringify(data)\n  });\n  console.log('Sent transcripts to the foreign university server');\n  return response;\n};\n\nconst BatchSend = props => {\n  _s();\n\n  const classes = useStyles();\n  const [partnerList, setPartnerList] = useState([]);\n  const [stats, setStats] = useState({});\n  const [batchedTranscripts, setBatchedTranscripts] = useState([]);\n  const [spinnerMessage, setSpinnerMessage] = React.useState(\"\");\n  const [selectedUniIndex, setSelectedUniIndex] = React.useState(-1);\n  const selectedUni = selectedUniIndex >= 0 ? partnerList[selectedUniIndex] : {};\n  const selectedUniName = selectedUniIndex >= 0 ? selectedUni.partner_university : \"all Universities\";\n  useEffect(() => {\n    setPartnerList(JSON.parse(localStorage.getItem('partnerUnis')));\n  }, []);\n  useEffect(() => {\n    const getStats = async () => {\n      setStats(await getPartnerStats(selectedUniName, isAuthenticated()));\n    };\n\n    const updateBatchedTranscripts = async () => {\n      setBatchedTranscripts(await readBatchedInternalTranscripts(isAuthenticated(), selectedUniName)); //receiverUni\n    };\n\n    getStats();\n    updateBatchedTranscripts();\n  }, [selectedUniName]);\n\n  const handleSendBatchedTranscripts = async () => {\n    console.log(`Sending batched transcripts to ${selectedUniName}`);\n    const token = isAuthenticated();\n    const combinedHash = hashTranscripts(batchedTranscripts);\n    await startService();\n\n    try {\n      const index = await sendTranscript(combinedHash, selectedUni.blockchain_address); //\n\n      for (var file of batchedTranscripts) {\n        console.log('file', file);\n        file.index = index;\n      }\n\n      await postToServer(selectedUni.server_address, batchedTranscripts);\n      await setTranscriptsToNotBatched(token, selectedUniName);\n    } catch (e) {\n      console.log(e);\n    }\n  };\n\n  const onSend = async () => {\n    setSpinnerMessage(\"Sending transcripts..\");\n    await handleSendBatchedTranscripts();\n    setSpinnerMessage(\"\");\n  };\n\n  return /*#__PURE__*/_jsxDEV(Container, {\n    children: [/*#__PURE__*/_jsxDEV(Spinner, {\n      message: spinnerMessage\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 231,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(AppNavBar, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 233,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(MUIContainer, {\n      maxWidth: \"sm\",\n      sx: {\n        mt: 5\n      },\n      children: [/*#__PURE__*/_jsxDEV(Typography, {\n        sx: {\n          mb: 1\n        },\n        children: \"Select a university to see some interaction statistics\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 236,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(SelectionList, {\n        options: partnerList,\n        selection: selectedUniIndex,\n        setSelection: setSelectedUniIndex\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 239,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"h4\",\n        style: {\n          textAlign: 'center',\n          marginTop: 50\n        },\n        children: [\"Interaction with \", selectedUniName]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 240,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 235,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(Grid, {\n      container: true,\n      spacing: 2,\n      sx: {\n        mt: 10\n      },\n      children: [/*#__PURE__*/_jsxDEV(Grid, {\n        item: true,\n        xs: 6,\n        children: stats.sent !== 0 || stats.recieved !== 0 ? /*#__PURE__*/_jsxDEV(PieChart, {\n          className: classes.chart,\n          animate: true,\n          label: _ref => {\n            let {\n              dataEntry\n            } = _ref;\n            return dataEntry.value === 0 ? '' : `${dataEntry.title}: ${dataEntry.value}`;\n          },\n          labelStyle: {\n            fontSize: '35%'\n          },\n          data: [{\n            title: 'Sent',\n            value: stats.sent,\n            color: '#E38627'\n          }, {\n            title: 'Received',\n            value: stats.recieved,\n            color: '#C13C37'\n          }]\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 246,\n          columnNumber: 25\n        }, this) : /*#__PURE__*/_jsxDEV(Typography, {\n          align: \"center\",\n          children: \"No transcripts have been exchanged yet\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 256,\n          columnNumber: 27\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 244,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Grid, {\n        item: true,\n        xs: 6,\n        children: [selectedUniIndex >= 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: classes.questionSectionContainer,\n          children: [/*#__PURE__*/_jsxDEV(Typography, {\n            children: [\"Number of batched transcripts: \", batchedTranscripts.length]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 263,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(Button, {\n            style: {\n              backgroundColor: \"rgb(53, 110, 255)\"\n            },\n            variant: \"contained\",\n            onClick: onSend,\n            disabled: batchedTranscripts.length === 0,\n            children: \" Send Batched Transcripts\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 264,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 262,\n          columnNumber: 25\n        }, this), selectedUniIndex < 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: classes.questionSectionContainer,\n          children: /*#__PURE__*/_jsxDEV(Typography, {\n            children: [\"Number of partner universities: \", partnerList.length]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 275,\n            columnNumber: 29\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 274,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 260,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 243,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 230,\n    columnNumber: 9\n  }, this);\n};\n\n_s(BatchSend, \"WJR96WWxISgXLrW/HwXeHFcjLKY=\", false, function () {\n  return [useStyles];\n});\n\n_c = BatchSend;\nexport default connect()(withRouter(BatchSend));\n\nvar _c;\n\n$RefreshReg$(_c, \"BatchSend\");","map":{"version":3,"sources":["/Users/bob/codes/mobility-blockchain-frontend/src/views/BatchSend.js"],"names":["React","useEffect","useState","withRouter","connect","Container","AppNavBar","makeStyles","Button","Typography","Grid","MUIContainer","getPartnerStats","isAuthenticated","PieChart","setTranscriptsToNotBatched","readBatchedInternalTranscripts","hash","sendTranscript","startService","SelectionList","hashTranscriptBatch","hashTranscripts","Spinner","useStyles","theme","container","display","justifyContent","textField","width","questionContainer","questionSectionContainer","flexDirection","alignItems","addQuestionIconContainer","height","circleIcon","leftPane","paddingTop","backgroundColor","border","leftPaneSection","rightPane","overflowY","rightPaneTop","padding","modal","marginTop","marginLeft","marginRight","minHeight","MenuItem","button","margin","sectionListContainer","surveyListContainer","surveyListItem","palette","primary","light","cursor","sectionListItem","upload","createSurveyButton","centerDiv","form","inline","chart","postToServer","address","data","response","fetch","JSON","stringify","console","log","BatchSend","props","classes","partnerList","setPartnerList","stats","setStats","batchedTranscripts","setBatchedTranscripts","spinnerMessage","setSpinnerMessage","selectedUniIndex","setSelectedUniIndex","selectedUni","selectedUniName","partner_university","parse","localStorage","getItem","getStats","updateBatchedTranscripts","handleSendBatchedTranscripts","token","combinedHash","index","blockchain_address","file","server_address","e","onSend","mt","mb","textAlign","sent","recieved","dataEntry","value","title","fontSize","color","length"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { withRouter } from \"react-router-dom\";\nimport { connect } from \"react-redux\";\nimport { Container } from \"react-bootstrap\";\nimport AppNavBar from \"../component/AppNavBar\";\nimport { makeStyles } from '@material-ui/core/styles';\nimport Button from '@material-ui/core/Button';\nimport { Typography, Grid, Container as MUIContainer } from '@mui/material';\nimport { getPartnerStats } from \"../services/api\";\nimport { isAuthenticated } from \"../auth/auth\";\nimport { PieChart } from 'react-minimal-pie-chart';\nimport { setTranscriptsToNotBatched, readBatchedInternalTranscripts } from \"../services/api\";\nimport hash from \"object-hash\";\nimport { sendTranscript } from \"../services/blockchain/contractCalls\";\nimport { startService } from \"../services/blockchain/util\";\nimport SelectionList from \"../component/SelectionList\";\nimport { hashTranscriptBatch, hashTranscripts } from \"../utils/accountUtils\";\nimport Spinner from \"../component/Spinner\";\n\n\nconst useStyles = makeStyles((theme) => ({\n    container: {\n        //height: '89vh',\n        display: 'flex',\n        justifyContent: 'start',\n        //backgroundColor: theme.palette.primary.light,\n\n    },\n    textField: {\n        width: '100%',\n    },\n    questionContainer: {\n        width: '70%',\n    },\n    questionSectionContainer: {\n        display: 'flex',\n        flexDirection: 'column',\n        alignItems: 'center'\n    },\n\n    addQuestionIconContainer: {\n        display: 'flex',\n        height: '12rem',\n    },\n    circleIcon: {\n        display: 'box',\n    },\n    leftPane: {\n        width: '60%',\n        paddingTop: '4rem',\n        backgroundColor: 'white',\n        display: 'flex',\n        flexDirection: 'column',\n        alignItems: 'center',\n        border: '1px grey solid'\n    },\n    leftPaneSection: {\n        display: 'flex',\n        flexDirection: 'column',\n        alignItems: 'center',\n    },\n    rightPane: {\n        width: '100%',\n        display: 'flex',\n        overflowY: 'scroll',\n        flexDirection: 'column',\n    },\n    rightPaneTop: {\n        height: '14.5rem',\n        display: 'flex',\n        flexDirection: 'column',\n        backgroundColor: 'white',\n        border: '1px grey solid',\n        padding: '2rem'\n    },\n\n    modal: {\n        display: 'flex',\n        flexDirection: 'column',\n        alignItems: 'center',\n        justifyContent: 'center',\n        marginTop: '15rem',\n        marginLeft: '30rem',\n        marginRight: '30rem',\n        minHeight: \"220px\",\n        width: \"40%\"\n    },\n    MenuItem: {\n        marginTop: \"30px\",\n    },\n    button: {\n        margin: \"2rem\",\n        justifyContent: 'center',\n    },\n    sectionListContainer: {\n        marginTop: '1rem',\n        height: '20rem',\n        width: '100%',\n        overflowY: 'scroll',\n    },\n    surveyListContainer: {\n        marginTop: '1rem',\n        height: '27.5rem',\n        width: '22rem',\n        overflowY: 'scroll',\n    },\n    surveyListItem: {\n        display: 'flex',\n        height: '4rem',\n        width: '100%',\n        alignItems: 'center',\n        justifyContent: 'space-between',\n        '&:hover': {\n            backgroundColor: theme.palette.primary.light,\n            cursor: 'pointer',\n        },\n    },\n    sectionListItem: {\n        'display': 'flex',\n        'justifyContent': 'center',\n        'height': '4rem',\n        'width': '70%',\n        'marginBottom': '0.5rem',\n        'marginTop': '0.5rem',\n        'alignItems': 'center',\n        '&:hover': {\n            'backgroundColor': theme.palette.primary.light,\n            'cursor': 'pointer',\n        },\n    },\n    upload: {\n        display: 'flex',\n        marginTop: '0.5rem',\n        height: '9rem',\n        width: '75%',\n    },\n    createSurveyButton: {\n        display: 'flex',\n        height: '3rem',\n        width: '15rem',\n    },\n    centerDiv: {\n        display: 'flex',\n        justifyContent: 'center',\n        marginTop: '1rem',\n    },\n    form: {\n        margin: '1rem',\n        width: '40%'\n    },\n    inline: {\n        display: 'flex',\n        justifyContent: 'space-between'\n    },\n    chart: {\n        height: '250px',\n    }\n}));\n\nconst postToServer = async (address, data) => {\n    const response = await fetch(address, {\n        'method': \"POST\",\n        'headers': {\n            'Accept': 'application/json',\n            'Content-Type': 'application/json',\n        },\n        'body': JSON.stringify(data),\n    });\n    console.log('Sent transcripts to the foreign university server');\n    return response;\n};\n\nconst BatchSend = (props) => {\n    const classes = useStyles();\n    const [partnerList, setPartnerList] = useState([]);\n    const [stats, setStats] = useState({});\n    const [batchedTranscripts, setBatchedTranscripts] = useState([]);\n    const [spinnerMessage, setSpinnerMessage] = React.useState(\"\");\n\n    const [selectedUniIndex, setSelectedUniIndex] = React.useState(-1);\n\n    const selectedUni = selectedUniIndex >= 0 ? partnerList[selectedUniIndex] : {};\n    const selectedUniName = selectedUniIndex >= 0 ? selectedUni.partner_university : \"all Universities\";\n\n    useEffect(() => {\n        setPartnerList(JSON.parse(localStorage.getItem('partnerUnis')));\n    }, []);\n\n    useEffect(() => {\n        const getStats = async () => {\n            setStats(await getPartnerStats(selectedUniName, isAuthenticated()));\n        };\n        const updateBatchedTranscripts = async () => {\n            setBatchedTranscripts(await readBatchedInternalTranscripts(isAuthenticated(), selectedUniName)); //receiverUni\n        };\n\n        getStats();\n        updateBatchedTranscripts();\n    }, [selectedUniName]);\n\n    const handleSendBatchedTranscripts = async () => {\n        console.log(`Sending batched transcripts to ${selectedUniName}`);\n\n        const token = isAuthenticated();\n\n        const combinedHash = hashTranscripts(batchedTranscripts);\n\n        await startService();\n\n        try {\n            const index = await sendTranscript(combinedHash, selectedUni.blockchain_address);//\n            for (var file of batchedTranscripts) {\n                console.log('file', file);\n                file.index = index;\n            }\n            await postToServer(selectedUni.server_address, batchedTranscripts);\n            await setTranscriptsToNotBatched(token, selectedUniName);\n        } catch (e) {\n            console.log(e);\n        }\n    };\n\n    const onSend = async () => {\n        setSpinnerMessage(\"Sending transcripts..\");\n        await handleSendBatchedTranscripts()\n        setSpinnerMessage(\"\");\n    };\n\n    return (\n        <Container>\n            <Spinner message={spinnerMessage} />\n\n            <AppNavBar></AppNavBar>\n\n            <MUIContainer maxWidth='sm' sx={{ mt: 5 }}>\n                <Typography sx={{ mb: 1 }}>\n                    Select a university to see some interaction statistics\n                </Typography>\n                <SelectionList options={partnerList} selection={selectedUniIndex} setSelection={setSelectedUniIndex} />\n                <Typography variant=\"h4\" style={{ textAlign: 'center', marginTop: 50 }}>Interaction with {selectedUniName}</Typography>\n            </MUIContainer>\n\n            <Grid container spacing={2} sx={{ mt: 10 }}>\n                <Grid item xs={6}>\n                    {stats.sent !== 0 || stats.recieved !== 0 ?\n                        <PieChart\n                            className={classes.chart}\n                            animate={true}\n                            label={({ dataEntry }) => dataEntry.value === 0 ? '' : `${dataEntry.title}: ${dataEntry.value}`}\n                            labelStyle={{ fontSize: '35%' }}\n                            data={[\n                                { title: 'Sent', value: stats.sent, color: '#E38627' },\n                                { title: 'Received', value: stats.recieved, color: '#C13C37' }\n                            ]}\n                        />\n                        : <Typography align=\"center\">No transcripts have been exchanged yet</Typography>\n                    }\n                </Grid>\n\n                <Grid item xs={6}>\n                    {selectedUniIndex >= 0 &&\n                        <div className={classes.questionSectionContainer}>\n                            <Typography>Number of batched transcripts: {batchedTranscripts.length}</Typography>\n                            <Button\n                                style={{ backgroundColor: \"rgb(53, 110, 255)\" }}\n                                variant=\"contained\"\n                                onClick={onSend}\n                                disabled={batchedTranscripts.length === 0}\n                            > Send Batched Transcripts\n                            </Button>\n                        </div>\n                    }\n                    {selectedUniIndex < 0 &&\n                        <div className={classes.questionSectionContainer}>\n                            <Typography>Number of partner universities: {partnerList.length}</Typography>\n                        </div>\n                    }\n                </Grid>\n            </Grid>\n        </Container>\n    );\n};\n\nexport default connect()(withRouter(BatchSend));"]},"metadata":{},"sourceType":"module"}